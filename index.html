<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Kuis Bahasa Jepang</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Latar belakang biru-abu muda */
            color: #334155; /* Warna teks lebih gelap */
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        textarea {
            resize: vertical;
            min-height: 150px;
            border-radius: 0.5rem;
            border: 1px solid #cbd5e1; /* Abu-abu-300 */
            padding: 0.75rem;
            font-size: 1rem;
            line-height: 1.5;
            color: #1a202c; /* Abu-abu-900 */
        }
        button {
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3b82f6; /* Biru-500 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-text {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body class="p-4">
    <div class="container">
        <h1 class="text-4xl font-extrabold text-center text-blue-700 mb-8 rounded-lg p-4 bg-white shadow-lg">
            Aplikasi Kuis Bahasa Jepang
        </h1>

        <!-- Modul Terjemahan Soal Cerita -->
        <div class="card">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">1. Terjemahan Soal Cerita (Indonesia ke Jepang)</h2>
            <p class="text-gray-600 mb-4">
                Pilih soal cerita di bawah ini dan terjemahkan dari bahasa Indonesia ke bahasa Jepang. AI akan membantu memeriksa akurasi terjemahan dan tata bahasa Anda.
            </p>
            <div class="mb-4">
                <label for="storySelector" class="block text-lg font-medium text-gray-700 mb-2">Pilih Soal Cerita:</label>
                <select id="storySelector" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md shadow-sm">
                    <option value="story1">Soal 1: Rio's Daily Life</option>
                    <option value="story2">Soal 2: Weekend at the Park</option>
                    <option value="story3">Soal 3: Summer Vacation in Kyoto</option>
                    <option value="story4">Soal 4: My Dog Pochi</option>
                </select>
            </div>
            <div class="bg-green-50 p-4 rounded-lg mb-6 border border-green-200">
                <p class="font-semibold text-green-800">Soal Cerita (Bahasa Indonesia):</p>
                <p id="storyText" class="text-green-700 leading-relaxed">
                    <!-- Teks cerita akan dimuat di sini oleh JavaScript -->
                </p>
            </div>
            <textarea id="translationInput" class="w-full mb-4 shadow-sm focus:ring-green-500 focus:border-green-500" placeholder="Tulis terjemahan bahasa Jepang Anda di sini..."></textarea>
            <button id="submitTranslation" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md flex items-center justify-center">
                <span id="translationLoadingSpinner" class="loading-spinner mr-2 hidden"></span>
                Periksa Terjemahan
            </button>

            <div id="translationFeedback" class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 min-h-[100px] text-gray-700 leading-relaxed overflow-auto">
                <!-- Hasil verifikasi terjemahan akan muncul di sini -->
                <p class="text-gray-500">Hasil verifikasi terjemahan akan ditampilkan di sini.</p>
            </div>
        </div>

        <!-- Modul Latihan Menulis Esai -->
        <div class="card">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">2. Latihan Menulis Esai (Bahasa Jepang)</h2>
            <p class="text-gray-600 mb-4">
                Tulis esai singkat dalam bahasa Jepang mengenai topik di bawah ini. AI akan membantu memeriksa tata bahasa dan ejaan Anda.
            </p>
            <div class="bg-blue-50 p-4 rounded-lg mb-6 border border-blue-200">
                <p class="font-semibold text-blue-800">Topik Esai:</p>
                <p class="text-blue-700">"Ceritakan tentang aktivitas harian Anda dari pagi hingga malam."</p>
            </div>
            <textarea id="essayInput" class="w-full mb-4 shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Tulis esai bahasa Jepang Anda di sini..."></textarea>
            <button id="submitEssay" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md flex items-center justify-center">
                <span id="essayLoadingSpinner" class="loading-spinner mr-2 hidden"></span>
                Periksa Esai
            </button>

            <div id="essayFeedback" class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 min-h-[100px] text-gray-700 leading-relaxed overflow-auto">
                <!-- Hasil verifikasi esai akan muncul di sini -->
                <p class="text-gray-500">Hasil verifikasi esai akan ditampilkan di sini.</p>
            </div>
        </div>
    </div>

    <script>
        // Kunci API Anda
        const API_KEY = "AIzaSyDZx9O-zay8DGv4S4MLFR9R_GqGB5xQI0c"; // Kunci API Anda

        // Data Cerita
        const storyData = {
            story1: `Halo! Nama saya Rio. Saya adalah seorang siswa. Setiap pagi, saya bangun jam tujuh. Saya makan roti dan minum susu. Setelah itu, saya pergi ke sekolah. Di sekolah, saya belajar bahasa Jepang dan matematika. Guru saya sangat baik dan selalu membantu kami memahami pelajaran.
Pelajaran di sekolah biasanya berakhir pada pukul tiga sore. Setelah sekolah, saya sering pergi ke perpustakaan sekolah. Di sana, saya menghabiskan waktu untuk membaca berbagai buku menarik atau mengerjakan pekerjaan rumah yang diberikan guru. Perpustakaan adalah tempat yang tenang dan nyaman, sangat cocok untuk belajar.
Kadang-kadang, saya juga bertemu teman-teman saya di perpustakaan untuk belajar kelompok. Kami saling membantu jika ada materi yang sulit. Setelah selesai dengan tugas sekolah, saya pun pulang ke rumah, biasanya sekitar pukul lima sore.
Sesampainya di rumah, saya suka bermain dengan kucing saya. Kucing saya namanya Kuro. Dia sangat lucu dan suka mengejar mainan kecil. Kami sering bermain di taman belakang rumah, berlarian dan tertawa bersama. Setelah itu, saya membantu ibu menyiapkan makan malam di dapur.
Malam hari, setelah makan malam, saya membaca buku. Saya sangat suka membaca buku cerita petualangan dan buku tentang sains. Membaca membuat saya merasa rileks dan saya selalu belajar banyak hal baru dari setiap halaman. Terkadang, saya juga menonton televisi sebentar sebelum tidur. Lalu, saya tidur, siap untuk hari yang baru besok.`,
            story2: `Setiap akhir pekan, saya suka pergi ke taman kota. Saya sering membawa buku dan membaca di bawah pohon besar. Kadang-kadang, saya melihat anak-anak bermain sepak bola atau keluarga piknik. Udara segar dan pemandangan hijau membuat saya merasa tenang. Sore hari, saya membeli es krim dari penjual keliling sebelum pulang.`,
            story3: `Liburan musim panas lalu, saya mengunjungi Kyoto bersama keluarga. Kami naik kereta cepat Shinkansen. Di Kyoto, kami mengunjungi banyak kuil kuno dan taman yang indah. Kuil Kinkaku-ji dengan paviliun emasnya sangat mengesankan. Kami juga mencoba makanan lokal yang lezat seperti ramen dan takoyaki. Itu adalah pengalaman yang tak terlupakan.`,
            story4: `Saya punya seekor anjing kecil bernama Pochi. Dia sangat aktif dan suka berlari. Setiap pagi dan sore, saya mengajaknya jalan-jalan di sekitar komplek perumahan. Pochi suka mengejar kupu-kupu dan bermain dengan anjing lain. Dia adalah teman terbaik saya dan selalu membuat saya tersenyum.`
        };

        // Dapatkan elemen-elemen
        const essayInput = document.getElementById('essayInput');
        const submitEssayButton = document.getElementById('submitEssay');
        const essayFeedback = document.getElementById('essayFeedback');
        const essayLoadingSpinner = document.getElementById('essayLoadingSpinner');

        const storySelector = document.getElementById('storySelector');
        const storyTextDisplay = document.getElementById('storyText');
        const translationInput = document.getElementById('translationInput');
        const submitTranslationButton = document.getElementById('submitTranslation');
        const translationFeedback = document.getElementById('translationFeedback');
        const translationLoadingSpinner = document.getElementById('translationLoadingSpinner');

        // Fungsi untuk memuat cerita yang dipilih
        function loadStory(storyKey) {
            storyTextDisplay.innerText = storyData[storyKey];
            translationInput.value = ''; // Hapus input terjemahan saat mengganti cerita
            translationFeedback.innerHTML = '<p class="text-gray-500">Hasil verifikasi terjemahan akan ditampilkan di sini.</p>'; // Hapus umpan balik
        }

        // Muat cerita awal
        loadStory(storySelector.value);

        // Event listener untuk perubahan pilihan cerita
        storySelector.addEventListener('change', (event) => {
            loadStory(event.target.value);
        });

        // Fungsi untuk memanggil Gemini API
        async function callGemini(prompt, targetElement, loadingSpinner) {
            loadingSpinner.classList.remove('hidden');
            targetElement.innerHTML = '<p class="text-gray-500">Memeriksa jawaban Anda dengan AI...</p>';
            targetElement.classList.add('animate-pulse'); // Tambahkan animasi berkedip

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Gemini API Error:', errorData);
                    targetElement.innerHTML = `<p class="text-red-600">Terjadi kesalahan saat menghubungi AI: ${errorData.error.message || 'Unknown error'}. Silakan coba lagi.</p>`;
                    return;
                }

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    // Bersihkan dan tampilkan konten HTML
                    targetElement.innerHTML = text;
                } else {
                    targetElement.innerHTML = '<p class="text-red-600">Tidak dapat memproses jawaban Anda. Respons AI tidak valid.</p>';
                }
            } catch (error) {
                console.error('Kesalahan pengambilan:', error);
                targetElement.innerHTML = `<p class="text-red-600">Terjadi kesalahan jaringan atau server: ${error.message}. Silakan coba lagi.</p>`;
            } finally {
                loadingSpinner.classList.add('hidden');
                targetElement.classList.remove('animate-pulse'); // Hapus animasi berkedip
            }
        }

        // Event listener untuk pengiriman Esai
        submitEssayButton.addEventListener('click', () => {
            const userEssay = essayInput.value.trim();
            if (userEssay === "") {
                essayFeedback.innerHTML = '<p class="text-red-600">Mohon tulis esai Anda terlebih dahulu.</p>';
                return;
            }

            const essayPrompt = `Tanggapan dalam bahasa Indonesia. Periksa esai bahasa Jepang ini untuk kesalahan tata bahasa, kesalahan ejaan, dan ungkapan yang tidak wajar. Untuk setiap kesalahan, sorot dengan teks merah tebal menggunakan tag <span style="color:red;font-weight:bold;">...</span> dan berikan versi yang benar dari teks yang disorot dalam bentuk petunjuk, diawali dengan <span style="color:green;">Seharusnya: </span> dalam tanda kurung tepat setelah teks yang disorot. Pastikan petunjuk tersebut singkat dan membantu. Pastikan bagian 'Seharusnya: [teks]' hanya menggunakan Hiragana dan Katakana, tanpa Kanji. Jika tidak ada kesalahan, tuliskan "Esai Anda sangat bagus! Tidak ada kesalahan yang ditemukan."
            jangan pakai kanji, cukup pakai hiragana dan katakana.
            Contoh format: わたしの<span style="color:red;font-weight:bold;">なまえはりおです。</span> (<span style="color:green;">Seharusnya: わたしのなまえはりおです</span>)

            Esai yang akan diperiksa:
            ${userEssay}`;

            callGemini(essayPrompt, essayFeedback, essayLoadingSpinner);
        });

        // Event listener untuk pengiriman Terjemahan
        submitTranslationButton.addEventListener('click', () => {
            const userTranslation = translationInput.value.trim();
            if (userTranslation === "") {
                translationFeedback.innerHTML = '<p class="text-red-600">Mohon tulis terjemahan Anda terlebih dahulu.</p>';
                return;
            }

            const currentStoryText = storyTextDisplay.innerText; // Dapatkan teks cerita yang sedang ditampilkan

            const translationPrompt = `Berikut adalah sebuah cerita dalam bahasa Indonesia:\n\n${currentStoryText}\n\nBerikut adalah terjemahan cerita tersebut dalam bahasa Jepang:\n\n${userTranslation}\n\nPeriksa terjemahan bahasa Jepang ini untuk keakuratan, kesalahan tata bahasa, kesalahan ejaan, dan ungkapan yang tidak wajar dibandingkan dengan teks asli dalam bahasa Indonesia. Untuk setiap kesalahan atau ketidakakuratan, sorot dengan teks merah tebal menggunakan tag <span style="color:red;font-weight:bold;">...</span> dan berikan versi yang benar dari teks yang disorot dalam bentuk petunjuk, diawali dengan '<span style="color:green;">Seharusnya: </span>' dalam tanda kurung tepat setelah teks yang disorot. Pastikan petunjuk tersebut singkat dan membantu. Pastikan bagian 'Seharusnya: [teks]' hanya menggunakan Hiragana dan Katakana, tanpa Kanji. Jika tidak ada kesalahan, tuliskan "Terjemahan Anda sangat bagus! Tidak ada kesalahan yang ditemukan."

            Contoh format: わたしの<span style="color:red;font-weight:bold;">なまえはリオです。</span> (<span style="color:green;">Seharusnya: わたしのなまえはリオです</span>)
            Terjemahan yang akan diperiksa:
            ${userTranslation}`;
            callGemini(translationPrompt, translationFeedback, translationLoadingSpinner);
        });
    </script>
</body>
</html>
